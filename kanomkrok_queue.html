<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏Ñ‡∏¥‡∏ß‡∏Ç‡∏ô‡∏°‡∏Ñ‡∏£‡∏Å</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:sans-serif;background:#fff3e0;margin:0;padding:15px}
h1{text-align:center;font-size:32px}
.item{background:#fff;border-radius:12px;padding:10px;margin-bottom:8px;font-size:18px}
.row{display:flex;justify-content:space-between;align-items:center}
.btn{font-size:20px;padding:6px 12px;border:none;border-radius:8px}
.add{background:#ff9800;color:#fff}
.sub{background:#ccc}
.done{background:#e53935;color:#fff}
.queue-box{background:#fff;border-radius:12px;padding:10px;margin-bottom:10px}
.summary{background:#fff;border-radius:12px;padding:15px;margin-top:15px;font-size:18px}
</style>
</head>
<body>

<h1>üç° ‡∏Ñ‡∏¥‡∏ß‡∏Ç‡∏ô‡∏°‡∏Ñ‡∏£‡∏Å</h1>

<div id="orderBox"></div>
<button class="btn add" style="width:100%" onclick="addQueue()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏¥‡∏ß</button>

<div id="queueList"></div>

<div class="summary">
<b>üìä ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</b><br>
‡∏´‡∏≠‡∏°: <span id="s_hom">0</span> |
‡πÄ‡∏ú‡∏∑‡∏≠‡∏Å: <span id="s_pueak">0</span> |
‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î: <span id="s_corn">0</span> |
‡∏£‡∏ß‡∏°: <span id="s_mix">0</span><br><br>

<b>üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°:</b> <span id="total">0</span> ‡∏ö‡∏≤‡∏ó<br>
<b>üèÜ ‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î:</b> <span id="best">-</span><br><br>

<button class="btn" onclick="exportCSV()">üì§ Excel</button>
<button class="btn" onclick="shareLine()">üì§ LINE</button>
<button class="btn" onclick="resetDay()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
</div>

<script>
const flavors=["‡∏´‡∏≠‡∏°","‡πÄ‡∏ú‡∏∑‡∏≠‡∏Å","‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î","‡∏£‡∏ß‡∏°"];
let prices={"‡∏´‡∏≠‡∏°":20,"‡πÄ‡∏ú‡∏∑‡∏≠‡∏Å":20,"‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î":20,"‡∏£‡∏ß‡∏°":25};

let queue=JSON.parse(localStorage.getItem("queue"))||[];
let summary=JSON.parse(localStorage.getItem("summary"))||{"‡∏´‡∏≠‡∏°":0,"‡πÄ‡∏ú‡∏∑‡∏≠‡∏Å":0,"‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î":0,"‡∏£‡∏ß‡∏°":0};
let qnum=JSON.parse(localStorage.getItem("qnum"))||1;

let current={"‡∏´‡∏≠‡∏°":0,"‡πÄ‡∏ú‡∏∑‡∏≠‡∏Å":0,"‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î":0,"‡∏£‡∏ß‡∏°":0};

function save(){
localStorage.setItem("queue",JSON.stringify(queue));
localStorage.setItem("summary",JSON.stringify(summary));
localStorage.setItem("qnum",qnum);
}

function renderOrder(){
orderBox.innerHTML="";
flavors.forEach(f=>{
orderBox.innerHTML+=`
<div class="item row">
${f}
<div>
<button class="btn sub" onclick="change('${f}',-1)">‚àí</button>
<b>${current[f]}</b>
<button class="btn add" onclick="change('${f}',1)">+</button>
</div>
</div>`;
});
}
function change(f,n){
current[f]=Math.max(0,current[f]+n);
renderOrder();
}

function addQueue(){
let items={};
let has=false;
flavors.forEach(f=>{
if(current[f]>0){items[f]=current[f];has=true;summary[f]+=current[f];}
});
if(!has){alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå");return;}
queue.push({num:qnum,items});
qnum++;
current={"‡∏´‡∏≠‡∏°":0,"‡πÄ‡∏ú‡∏∑‡∏≠‡∏Å":0,"‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î":0,"‡∏£‡∏ß‡∏°":0};
save();
render();
renderOrder();
}

function render(){
queueList.innerHTML="";
queue.forEach((q,i)=>{
let list="";
for(let f in q.items){list+=`${f} x ${q.items[f]}<br>`;}
queueList.innerHTML+=`
<div class="queue-box">
<b>‡∏Ñ‡∏¥‡∏ß ${q.num}</b><br>${list}
<button class="btn done" onclick="finish(${i})">‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</button>
</div>`;
});
calc();
}

function finish(i){
queue.splice(i,1);
save();
render();
}

function calc(){
let total=0,max=0,best=[];
for(let f in summary){
document.getElementById("s_"+(f=="‡πÄ‡∏ú‡∏∑‡∏≠‡∏Å"?"pueak":f=="‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î"?"corn":f=="‡∏£‡∏ß‡∏°"?"mix":"hom")).innerText=summary[f];
total+=summary[f]*prices[f];
if(summary[f]>max){max=summary[f];best=[f];}
else if(summary[f]==max&&max>0)best.push(f);
}
document.getElementById("total").innerText=total;
document.getElementById("best").innerText=best.join(", ")||"-";
}

function exportCSV(){
let csv="‡πÑ‡∏™‡πâ,‡∏à‡∏≥‡∏ô‡∏ß‡∏ô,‡∏£‡∏≤‡∏Ñ‡∏≤,‡πÄ‡∏á‡∏¥‡∏ô\n";
for(let f in summary){csv+=`${f},${summary[f]},${prices[f]},${summary[f]*prices[f]}\n`;}
let a=document.createElement("a");
a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
a.download="kanomkrok_today.csv";a.click();
}

function shareLine(){
let t="‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏ô‡∏°‡∏Ñ‡∏£‡∏Å‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ\n";
for(let f in summary){t+=`${f}: ${summary[f]} ‡∏Ñ‡∏¥‡∏ß\n`;}
t+=`‡∏£‡∏ß‡∏° ${total.innerText} ‡∏ö‡∏≤‡∏ó`;
navigator.share?navigator.share({text:t}):alert(t);
}

function resetDay(){
if(!confirm("‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà?"))return;
queue=[];summary={"‡∏´‡∏≠‡∏°":0,"‡πÄ‡∏ú‡∏∑‡∏≠‡∏Å":0,"‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î":0,"‡∏£‡∏ß‡∏°":0};qnum=1;
save();render();
}

renderOrder();render();
</script>

</body>
</html>
